<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NewsDesk Speedboat INT</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{--bg:#0a0c0f;--bg2:#0f1318;--panel:#111518;--border:#1c2530;--border2:#243040;--accent:#e8a020;--red:#e04455;--text:#ccd8e0;--text2:#7a9aaa;--dim:#354555;--mono:'IBM Plex Mono',monospace;--sans:'IBM Plex Sans',sans-serif;}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;overflow:hidden;background:var(--bg);color:var(--text);font-family:var(--sans);}
body{display:flex;flex-direction:column;}

header{display:flex;align-items:center;gap:14px;padding:0 16px;height:40px;flex-shrink:0;background:var(--bg2);border-bottom:2px solid var(--accent);}
.logo{font-family:var(--mono);font-weight:600;font-size:0.75rem;letter-spacing:0.28em;color:var(--accent);}
.sep{width:1px;height:18px;background:var(--border2);}
#clock{font-family:var(--mono);font-size:0.75rem;color:var(--accent);}
.live{font-family:var(--mono);font-size:0.58rem;color:var(--red);letter-spacing:0.2em;animation:blink 2s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}
.header-right{margin-left:auto;display:flex;align-items:center;gap:10px;}
#load-status{font-family:var(--mono);font-size:0.6rem;color:var(--accent);}
.btn{font-family:var(--mono);font-size:0.58rem;padding:3px 10px;background:transparent;border:1px solid var(--border2);color:var(--text2);cursor:pointer;border-radius:2px;transition:all .2s;}
.btn:hover{border-color:var(--accent);color:var(--accent);}

.columns-wrap{flex:1;display:flex;gap:1px;background:var(--border);overflow:hidden;min-height:0;}

.col{flex:1;display:flex;flex-direction:column;background:var(--panel);overflow:hidden;}
.col-head{padding:7px 10px;background:var(--bg2);border-bottom:1px solid var(--border);border-top:2px solid var(--accent);font-family:var(--mono);font-size:0.62rem;font-weight:600;letter-spacing:0.16em;flex-shrink:0;display:flex;align-items:center;}
.col-name{flex:1;color:var(--accent);}
.col-count{color:var(--dim);font-weight:400;}
.col-items{flex:1;overflow-y:auto;scrollbar-width:thin;scrollbar-color:var(--border) transparent;}
.col-items::-webkit-scrollbar{width:3px;}
.col-items::-webkit-scrollbar-thumb{background:var(--border2);}
.col-msg{padding:16px 12px;font-family:var(--mono);font-size:0.6rem;color:var(--dim);text-align:center;animation:pulse 1.5s infinite;}
@keyframes pulse{0%,100%{opacity:.3}50%{opacity:1}}

.item{display:block;text-decoration:none;padding:10px 12px;border-bottom:1px solid var(--border);transition:background .12s;}
.item:hover{background:rgba(232,160,32,.07);}
.item:hover .item-title{color:var(--accent);}
.item-title{font-size:0.8rem;line-height:1.48;color:var(--text);transition:color .12s;margin-bottom:4px;}
.item-time{font-family:var(--mono);font-size:0.5rem;color:var(--dim);}

.ticker{display:flex;align-items:center;height:22px;background:var(--bg2);border-top:1px solid var(--border2);overflow:hidden;flex-shrink:0;}
.ticker-lbl{font-family:var(--mono);font-size:0.52rem;font-weight:600;color:var(--bg);background:var(--accent);padding:0 10px;height:100%;display:flex;align-items:center;letter-spacing:0.18em;flex-shrink:0;}
.ticker-track{flex:1;overflow:hidden;}
.ticker-txt{display:inline-block;white-space:nowrap;font-family:var(--mono);font-size:0.75rem;color:var(--accent);animation:scroll 45s linear infinite;}
.ticker-txt:hover{animation-play-state:paused;}
@keyframes scroll{from{transform:translateX(100vw)}to{transform:translateX(-100%)}}
</style>
</head>
<body>

<header>
  <div class="logo">▸ NEWSDESK SPEEDBOAT INT</div>
  <div class="sep"></div>
  <div id="clock">--:--:--</div>
  <div class="sep"></div>
  <div class="live">● LIVE</div>
  <div class="header-right">
    <span id="load-status"></span>
    <button class="btn" onclick="refreshAll()">⟳ REFRESH</button>
  </div>
</header>

<div class="ticker">
  <div style="display:flex;align-items:center;gap:6px;padding:0 10px;flex-shrink:0;">
    <input type="text" id="search-box" placeholder="Suche…" oninput="render()"
      style="font-family:var(--mono);font-size:0.58rem;padding:1px 7px;background:var(--panel);border:1px solid var(--border2);color:var(--text);border-radius:2px;width:160px;outline:none;height:16px;">
    <span id="search-count" style="font-family:var(--mono);font-size:0.52rem;color:var(--dim);white-space:nowrap;"></span>
  </div>
  <div class="ticker-lbl">LATEST</div>
  <div class="ticker-track"><span class="ticker-txt" id="ticker-txt">Lade…</span></div>
</div>
<div class="columns-wrap" id="columns"></div>


<script>
const FEEDS = [
  {name:'BAHA',      url:'https://breakingthenews.net/news-feed.xml'},
  {name:'FRANCE 24', url:'https://www.france24.com/en/rss'},
  {name:'BNO',       url:'https://bnonews.com/index.php/feed/'},
  {name:'ABC',       url:'https://feeds.abcnews.com/abcnews/topstories'},
  {name:'NBC',       url:'https://feeds.nbcnews.com/nbcnews/public/news'},
  {name:'CBS',       url:'https://www.cbsnews.com/latest/rss/main'},
  {name:'AL JAZEERA',url:'https://www.aljazeera.com/xml/rss/all.xml'},
];

const PROXIES = [
  url => `https://corsproxy.io/?url=${encodeURIComponent(url)}`,
  url => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
  url => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`,
];

const data = FEEDS.map(f=>({...f, items:[], status:'pending'}));
let loadedCount = 0;

// Clock
setInterval(()=>{
  const n=new Date(), p=x=>String(x).padStart(2,'0');
  document.getElementById('clock').textContent=
    `${p(n.getUTCHours())}:${p(n.getUTCMinutes())}:${p(n.getUTCSeconds())} UTC · `+
    n.toLocaleDateString('de-DE',{weekday:'short',day:'2-digit',month:'short'});
},1000);

async function fetchFeed(url) {
  for (const proxy of PROXIES) {
    try {
      const res = await fetch(proxy(url), {signal: AbortSignal.timeout(10000)});
      if (!res.ok) continue;
      const text = await res.text();
      if (text.includes('<item') || text.includes('<entry')) return text;
    } catch(e) { continue; }
  }
  return null;
}

function parseXML(xml) {
  try {
    const doc = new DOMParser().parseFromString(xml, 'text/xml');
    return [...doc.querySelectorAll('item,entry')].slice(0,50).map(el=>{
      const title = clean(el.querySelector('title')?.textContent||'');
      const link  = el.querySelector('link')?.textContent?.trim() || el.querySelector('link')?.getAttribute('href') || '#';
      const pub   = el.querySelector('pubDate,published,updated')?.textContent||'';
      return {title, link, pub};
    }).filter(i=>i.title.length>3);
    parsed.sort((a,b)=>new Date(b.pub)-new Date(a.pub));
    return parsed.slice(0,50);
  } catch(e) { return []; }
}

function render() {
  const q = document.getElementById('search-box') ? document.getElementById('search-box').value.toLowerCase().trim() : '';
  let totalHits = 0;
  document.getElementById('columns').innerHTML = data.map(feed=>{
    const items = q ? feed.items.filter(i=>i.title.toLowerCase().includes(q)) : feed.items;
    if(q) totalHits += items.length;
    const st = feed.status;
    const body =
      st==='pending'||st==='loading' ? `<div class="col-msg">⟳ lädt…</div>` :
      st==='fail' ? `<div class="col-msg" style="animation:none;color:#503030;">Nicht verfügbar</div>` :
      items.map(i=>`<a class="item" href="${i.link}" target="_blank" rel="noopener">
        <div class="item-title">${esc(i.title)}</div>
        <div class="item-time">${timeAgo(i.pub)}</div>
      </a>`).join('');
    return `<div class="col">
      <div class="col-head"><span class="col-name">${esc(feed.name)}</span><span class="col-count">${st==='ok'?feed.items.length:''}</span></div>
      <div class="col-items">${body}</div>
    </div>`;
  }).join('');
  const sc = document.getElementById('search-count');
  if(sc) sc.textContent = q ? `${totalHits} Treffer` : '';
}

async function loadFeed(feed) {
  feed.status = 'loading'; render();
  try {
    const xml = await fetchFeed(feed.url);
    if (!xml) throw new Error('blocked');
    const items = parseXML(xml);
    feed.items  = items;
    feed.status = items.length ? 'ok' : 'fail';
  } catch(e) {
    feed.status = 'fail';
  }
  loadedCount++;
  const ok = data.filter(f=>f.status==='ok').length;
  document.getElementById('load-status').textContent =
    loadedCount < data.length ? `${loadedCount}/${data.length}…` : `✓ ${ok} von ${data.length} aktiv`;
  const latest = data.filter(f=>f.status==='ok'&&f.items[0]).map(f=>`[${f.name}] ${f.items[0].title}`);
  if (latest.length) document.getElementById('ticker-txt').textContent = latest.join('   //   ');
  render();
}

async function refreshAll() {
  loadedCount = 0;
  data.forEach(f=>{f.items=[];f.status='pending';});
  document.getElementById('load-status').textContent = 'lädt…';
  render();
  await Promise.allSettled(data.map(loadFeed));
}

refreshAll();
setInterval(refreshAll, 180000);

function timeAgo(d) {
  if(!d) return '';
  const m = Math.floor((Date.now()-new Date(d))/60000);
  if(isNaN(m)||m<0) return '';
  if(m<2)    return 'eben';
  if(m<60)   return `${m} Min.`;
  if(m<1440) return `${Math.floor(m/60)} Std.`;
  return `${Math.floor(m/1440)}d`;
}
function clean(s){return(s||'').replace(/<!\[CDATA\[|\]\]>/g,'').replace(/<[^>]+>/g,'').trim();}
function esc(s){return(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
</script>
</body>
</html>
