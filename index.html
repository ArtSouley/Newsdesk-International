<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NewsDesk Speedboat INT</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{--bg:#0a0c0f;--bg2:#0f1318;--panel:#111518;--border:#1c2530;--border2:#243040;--accent:#e8a020;--red:#e04455;--text:#ccd8e0;--text2:#7a9aaa;--dim:#354555;--mono:'IBM Plex Mono',monospace;--sans:'IBM Plex Sans',sans-serif;}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;overflow:hidden;background:var(--bg);color:var(--text);font-family:var(--sans);}
body{display:flex;flex-direction:column;}
header{display:flex;align-items:center;gap:14px;padding:0 16px;height:40px;flex-shrink:0;background:var(--bg2);border-bottom:2px solid var(--accent);}
.logo{font-family:var(--mono);font-weight:600;font-size:0.75rem;letter-spacing:0.28em;color:var(--accent);}
.sep{width:1px;height:18px;background:var(--border2);}
#clock{font-family:var(--mono);font-size:0.75rem;color:var(--text2);}
.live{font-family:var(--mono);font-size:0.58rem;color:var(--red);letter-spacing:0.2em;animation:blink 2s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}
.header-right{margin-left:auto;display:flex;align-items:center;gap:10px;}
#load-status{font-family:var(--mono);font-size:0.6rem;color:var(--accent);}
.btn{font-family:var(--mono);font-size:0.58rem;padding:3px 10px;background:transparent;border:1px solid var(--border2);color:var(--text2);cursor:pointer;border-radius:2px;transition:all .2s;}
.btn:hover{border-color:var(--accent);color:var(--accent);}
.btn-red{border-color:#3a2020;color:#604040;}.btn-red:hover{border-color:var(--red);color:var(--red);}
#login-screen{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px;padding:40px;}
#login-screen h1{font-family:var(--mono);font-size:0.9rem;color:var(--accent);letter-spacing:0.25em;}
.login-box{background:var(--bg2);border:1px solid var(--border2);border-radius:4px;padding:24px;width:360px;display:flex;flex-direction:column;gap:12px;}
.login-box label{font-family:var(--mono);font-size:0.58rem;color:var(--dim);letter-spacing:0.1em;}
.login-box input{width:100%;padding:8px 10px;background:var(--panel);border:1px solid var(--border2);color:var(--text);font-family:var(--mono);font-size:0.7rem;border-radius:2px;}
.login-box input:focus{outline:none;border-color:var(--accent);}
.login-submit{width:100%;padding:9px;background:var(--accent);color:var(--bg);border:none;cursor:pointer;font-family:var(--mono);font-size:0.65rem;letter-spacing:0.15em;border-radius:2px;}
#login-error{font-family:var(--mono);font-size:0.6rem;color:var(--red);text-align:center;display:none;}
.login-note{font-family:var(--mono);font-size:0.52rem;color:var(--dim);text-align:center;line-height:1.8;}
.ticker{display:flex;align-items:center;height:26px;background:var(--bg2);border-bottom:1px solid var(--border2);overflow:hidden;flex-shrink:0;}
.ticker-lbl{font-family:var(--mono);font-size:0.52rem;font-weight:600;color:var(--bg);background:var(--accent);padding:0 10px;height:100%;display:flex;align-items:center;letter-spacing:0.18em;flex-shrink:0;}
.ticker-track{flex:1;overflow:hidden;}
.ticker-txt{display:inline-block;white-space:nowrap;font-family:var(--mono);font-size:0.75rem;color:var(--accent);animation:scroll 45s linear infinite;}
.ticker-txt:hover{animation-play-state:paused;}
@keyframes scroll{from{transform:translateX(100vw)}to{transform:translateX(-100%)}}
.search-wrap{display:flex;align-items:center;gap:6px;padding:0 10px;flex-shrink:0;}
#search-box{font-family:var(--mono);font-size:0.58rem;padding:1px 7px;background:var(--panel);border:1px solid var(--border2);color:var(--text);border-radius:2px;width:160px;outline:none;height:18px;}
#search-box:focus{border-color:var(--accent);}
#search-count{font-family:var(--mono);font-size:0.52rem;color:var(--dim);white-space:nowrap;}
.columns-wrap{flex:1;display:flex;gap:1px;background:var(--border);overflow:hidden;min-height:0;}
.col{flex:1;min-width:200px;display:flex;flex-direction:column;background:var(--panel);overflow:hidden;}
.col-head{padding:6px 8px;background:var(--bg2);border-bottom:1px solid var(--border);border-top:2px solid var(--accent);font-family:var(--mono);font-size:0.55rem;font-weight:600;letter-spacing:0.14em;flex-shrink:0;display:flex;align-items:center;}
.col-name{flex:1;color:var(--accent);}
.col-count{color:var(--dim);font-weight:400;}
.col-items{flex:1;overflow-y:auto;scrollbar-width:thin;scrollbar-color:var(--border) transparent;}
.col-items::-webkit-scrollbar{width:3px;}
.col-items::-webkit-scrollbar-thumb{background:var(--border2);}
.col-msg{padding:16px 12px;font-family:var(--mono);font-size:0.6rem;color:var(--dim);text-align:center;animation:pulse 1.5s infinite;}
@keyframes pulse{0%,100%{opacity:.3}50%{opacity:1}}
.item{display:block;text-decoration:none;padding:10px 12px;border-bottom:1px solid var(--border);transition:background .12s;}
.item:hover{background:rgba(232,160,32,.07);}
.item:hover .item-title{color:var(--accent);}
.item-title{font-size:0.78rem;line-height:1.45;color:var(--text);transition:color .12s;margin-bottom:4px;}
.item-time{font-family:var(--mono);font-size:0.5rem;color:var(--accent);}
</style>
</head>
<body>
<header>
  <div class="logo">&#9658; NEWSDESK SPEEDBOAT INT</div>
  <div class="sep"></div>
  <div id="clock">--:--:--</div>
  <div class="sep"></div>
  <div class="live">&#9679; LIVE</div>
  <div class="header-right">
    <span id="load-status"></span>
    <button class="btn" id="btn-refresh" onclick="refreshAll()" style="display:none">&#10227; REFRESH</button>
    <button class="btn btn-red" id="btn-logout" onclick="logout()" style="display:none">Logout</button>
  </div>
</header>

<div id="login-screen">
  <h1>&#9658; NEWSDESK SPEEDBOAT INT</h1>
  <div class="login-box">
    <label>INOREADER E-MAIL</label>
    <input type="email" id="inp-email" placeholder="sartiisik@googlemail.com" autocomplete="email">
    <label>PASSWORT</label>
    <input type="password" id="inp-pass" placeholder="&#8226;&#8226;&#8226;&#8226;&#8226;&#8226;&#8226;&#8226;" autocomplete="current-password">
    <div id="login-error">Login fehlgeschlagen — bitte prüfen Sie Ihre Zugangsdaten.</div>
    <button class="login-submit" onclick="doLogin()">ANMELDEN</button>
  </div>
  <div class="login-note">Ihre Daten werden nur zur Authentifizierung bei Inoreader verwendet.</div>
</div>

<div id="dashboard" style="display:none;flex:1;flex-direction:column;overflow:hidden;">
  <div class="ticker">
    <div class="search-wrap">
      <input type="text" id="search-box" placeholder="Search..." oninput="render()">
      <span id="search-count"></span>
    </div>
    <div class="ticker-lbl">LATEST</div>
    <div class="ticker-track"><span class="ticker-txt" id="ticker-txt">Loading...</span></div>
  </div>
  <div class="columns-wrap" id="columns"></div>
</div>

<script>
const CLIENT_ID  = '1000008397';
const CLIENT_KEY = 'CTPkYtw_egWhJikQPxNPC6slXSgcNQuAt';
const API_BASE   = 'https://www.inoreader.com/reader/api/0';

const FEEDS = [
  {name:'BAHA',       url:'https://breakingthenews.net/news-feed.xml'},
  {name:'FRANCE 24',  url:'https://www.france24.com/en/rss'},
  {name:'BNO',        url:'https://bnonews.com/index.php/feed/'},
  {name:'ABC',        url:'https://feeds.abcnews.com/abcnews/topstories'},
  {name:'NBC',        url:'https://feeds.nbcnews.com/nbcnews/public/news'},
  {name:'CBS',        url:'https://www.cbsnews.com/latest/rss/main'},
  {name:'AL JAZEERA', url:'https://www.aljazeera.com/xml/rss/all.xml'},
];

const data = FEEDS.map(f=>({...f,items:[],status:'pending'}));
let authToken = sessionStorage.getItem('ino_auth_int')||null;
let loadedCount = 0;

setInterval(()=>{
  const n=new Date(),p=x=>String(x).padStart(2,'0');
  document.getElementById('clock').textContent=
    `${p(n.getUTCHours())}:${p(n.getUTCMinutes())}:${p(n.getUTCSeconds())} UTC · `+
    n.toLocaleDateString('de-DE',{weekday:'short',day:'2-digit',month:'short'});
},1000);

document.addEventListener('keydown',e=>{
  if(e.key==='Enter'&&document.getElementById('login-screen').style.display!=='none') doLogin();
});

async function doLogin(){
  const email=document.getElementById('inp-email').value.trim();
  const pass=document.getElementById('inp-pass').value;
  const errEl=document.getElementById('login-error');
  const btn=document.querySelector('.login-submit');
  if(!email||!pass) return;
  btn.textContent='Anmelden...'; btn.disabled=true; errEl.style.display='none';
  try{
    const res=await fetch('https://www.inoreader.com/accounts/ClientLogin',{
      method:'POST',
      headers:{'Content-Type':'application/x-www-form-urlencoded','AppId':CLIENT_ID,'AppKey':CLIENT_KEY},
      body:`Email=${encodeURIComponent(email)}&Passwd=${encodeURIComponent(pass)}`
    });
    const text=await res.text();
    if(!res.ok||!text.includes('Auth=')) throw new Error('failed');
    const match=text.match(/Auth=(.+)/);
    if(!match) throw new Error('no token');
    authToken=match[1].trim();
    sessionStorage.setItem('ino_auth_int',authToken);
    initDashboard();
  }catch(e){
    errEl.style.display='block';
    btn.textContent='ANMELDEN'; btn.disabled=false;
  }
}

function logout(){
  sessionStorage.removeItem('ino_auth_int');
  authToken=null; location.reload();
}

async function apiFetch(feedUrl){
  const streamId=`feed/${feedUrl}`;
  const url=`${API_BASE}/stream/contents/${encodeURIComponent(streamId)}?n=50&output=json`;
  const res=await fetch(url,{
    headers:{'Authorization':`GoogleLogin auth=${authToken}`,'AppId':CLIENT_ID,'AppKey':CLIENT_KEY},
    signal:AbortSignal.timeout(12000)
  });
  if(res.status===401||res.status===403){logout();throw new Error('Session abgelaufen');}
  if(!res.ok) throw new Error(res.status);
  return res.json();
}

function initDashboard(){
  document.getElementById('login-screen').style.display='none';
  const dash=document.getElementById('dashboard');
  dash.style.display='flex';
  document.getElementById('btn-refresh').style.display='';
  document.getElementById('btn-logout').style.display='';
  refreshAll();
}

function render(){
  const q=document.getElementById('search-box')?.value.toLowerCase().trim()||'';
  let totalHits=0;
  document.getElementById('columns').innerHTML=data.map(feed=>{
    const items=q?feed.items.filter(i=>i.title.toLowerCase().includes(q)):feed.items;
    if(q) totalHits+=items.length;
    const st=feed.status;
    const body=
      st==='pending'||st==='loading'?'<div class="col-msg">&#10227; loading...</div>':
      st==='fail'?'<div class="col-msg" style="animation:none;color:#503030;">Not available</div>':
      items.length?items.map(i=>`<a class="item" href="${i.link}" target="_blank" rel="noopener">
        <div class="item-title">${esc(i.title)}</div>
        <div class="item-time">${timeAgo(i.pub)}</div>
      </a>`).join(''):'<div class="col-msg" style="animation:none;">No articles</div>';
    return `<div class="col">
      <div class="col-head"><span class="col-name">${esc(feed.name)}</span><span class="col-count">${st==='ok'?items.length:''}</span></div>
      <div class="col-items">${body}</div>
    </div>`;
  }).join('');
  const sc=document.getElementById('search-count');
  if(sc) sc.textContent=q?`${totalHits} results`:'';
}

async function loadFeed(feed){
  feed.status='loading'; render();
  try{
    const json=await apiFetch(feed.url);
    const items=(json.items||[]).map(i=>({
      title:clean(i.title||''),
      link:i.canonical?.[0]?.href||i.alternate?.[0]?.href||'#',
      pub:i.published?new Date(i.published*1000).toISOString():'',
    })).filter(i=>i.title.length>3);
    items.sort((a,b)=>new Date(b.pub)-new Date(a.pub));
    feed.items=items; feed.status=items.length?'ok':'fail';
  }catch(e){feed.status='fail';}
  loadedCount++;
  const ok=data.filter(f=>f.status==='ok').length;
  document.getElementById('load-status').textContent=
    loadedCount<data.length?`${loadedCount}/${data.length}...`:`&#10003; ${ok} of ${data.length} active`;
  const latest=data.filter(f=>f.status==='ok'&&f.items[0]).map(f=>`[${f.name}] ${f.items[0].title}`);
  if(latest.length) document.getElementById('ticker-txt').textContent=latest.join('   //   ');
  render();
}

async function refreshAll(){
  loadedCount=0;
  data.forEach(f=>{f.items=[];f.status='pending';});
  document.getElementById('load-status').textContent='Loading...';
  render();
  await Promise.allSettled(data.map(loadFeed));
}

function timeAgo(d){
  if(!d) return '';
  const m=Math.floor((Date.now()-new Date(d))/60000);
  if(isNaN(m)||m<0) return '';
  if(m<2) return 'just now';
  if(m<60) return `${m} min`;
  if(m<1440) return `${Math.floor(m/60)} hrs`;
  return `${Math.floor(m/1440)}d`;
}
function clean(s){return(s||''). replace(/<!\[CDATA\[|\]\]>/g,'').replace(/<[^>]+>/g,'').trim();}
function esc(s){return(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

if(authToken) initDashboard();
setInterval(()=>{if(authToken) refreshAll();},180000);
</script>
</body>
</html>